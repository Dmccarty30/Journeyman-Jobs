<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Troubleshooting Guide - Journeyman Jobs</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; margin: 0; padding: 20px; background-color: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #1a202c; border-bottom: 3px solid #b45309; padding-bottom: 10px; }
        h2 { color: #2d3748; margin-top: 30px; }
        h3 { color: #4a5568; }
        .alert { padding: 16px; border-radius: 8px; margin: 20px 0; border-left: 4px solid; }
        .alert-critical { background-color: #fed7d7; border-color: #fc8181; color: #c53030; }
        .alert-warning { background-color: #fef5e7; border-color: #f6ad55; color: #c05621; }
        .alert-info { background-color: #e6fffa; border-color: #81e6d9; color: #234e52; }
        .alert-success { background-color: #c6f6d5; border-color: #68d391; color: #22543d; }
        .code-block { background-color: #1a202c; color: #e2e8f0; padding: 20px; border-radius: 8px; overflow-x: auto; margin: 15px 0; }
        .code { background-color: #f7fafc; padding: 2px 6px; border-radius: 4px; font-family: monospace; color: #2d3748; }
        .issue { background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #e53e3e; }
        .solution { background: #c6f6d5; padding: 15px; margin: 10px 0; border-radius: 6px; border-left: 4px solid #38a169; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #1a202c; color: white; }
        .severity-critical { color: #c53030; font-weight: bold; }
        .severity-high { color: #dd6b20; font-weight: bold; }
        .severity-medium { color: #d69e2e; }
        .severity-low { color: #38a169; }
        .nav { background-color: #1a202c; padding: 20px; margin: -40px -40px 40px -40px; border-radius: 10px 10px 0 0; }
        .nav h1 { color: white; margin: 0; border: none; }
        .nav p { color: #e2e8f0; margin: 5px 0 0 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <h1>üîß Production Troubleshooting Guide</h1>
            <p>Journeyman Jobs - Job Sharing Feature Issue Resolution</p>
        </div>

        <div class="alert alert-critical">
            <strong>üö® Emergency Hotline:</strong> For critical production issues affecting IBEW member access, contact the technical team immediately. Never attempt complex fixes during peak usage hours (7 AM - 7 PM) without proper authorization.
        </div>

        <h2>üìä Issue Triage & Severity Classification</h2>

        <table>
            <tr>
                <th>Severity</th>
                <th>Description</th>
                <th>Response Time</th>
                <th>Examples</th>
            </tr>
            <tr>
                <td><span class="severity-critical">Critical</span></td>
                <td>Complete service outage, data loss, security breach</td>
                <td>< 15 minutes</td>
                <td>App crashes, database corruption, authentication failures</td>
            </tr>
            <tr>
                <td><span class="severity-high">High</span></td>
                <td>Major feature broken, performance severely degraded</td>
                <td>< 1 hour</td>
                <td>Job sharing not working, notifications failing</td>
            </tr>
            <tr>
                <td><span class="severity-medium">Medium</span></td>
                <td>Minor feature issues, moderate performance impact</td>
                <td>< 4 hours</td>
                <td>Contact picker glitches, minor UI issues</td>
            </tr>
            <tr>
                <td><span class="severity-low">Low</span></td>
                <td>Cosmetic issues, feature enhancements</td>
                <td>< 24 hours</td>
                <td>Typography issues, minor UX improvements</td>
            </tr>
        </table>

        <h2>üö® Critical Issues</h2>

        <div class="issue">
            <h3>üî• App Crashes on Startup</h3>
            <p><strong>Symptoms:</strong> Users cannot open the app, immediate crashes, white screen of death</p>
            <p><strong>Impact:</strong> Complete service unavailable</p>
            <p><strong>Priority:</strong> <span class="severity-critical">Critical</span></p>
            
            <div class="solution">
                <strong>Immediate Actions:</strong>
                <div class="code-block">
# Check recent deployments
firebase functions:log --limit 100

# Check app store reviews and crash reports
# iOS: App Store Connect ‚Üí App Analytics ‚Üí Crashes
# Android: Google Play Console ‚Üí Quality ‚Üí Crashes

# Emergency rollback if recent deployment caused issue
firebase rollback functions
git checkout HEAD~1 lib/
flutter build appbundle --release
                </div>
                
                <strong>Investigation Steps:</strong>
                <ol>
                    <li>Check Firebase Console for authentication issues</li>
                    <li>Verify Firestore rules aren't blocking initial data load</li>
                    <li>Check for breaking changes in Firebase SDK versions</li>
                    <li>Review recent code changes in main.dart and app initialization</li>
                </ol>
            </div>
        </div>

        <div class="issue">
            <h3>üîê Authentication System Down</h3>
            <p><strong>Symptoms:</strong> Users cannot log in, "Authentication failed" errors</p>
            <p><strong>Impact:</strong> No user access to any features</p>
            <p><strong>Priority:</strong> <span class="severity-critical">Critical</span></p>
            
            <div class="solution">
                <strong>Immediate Diagnostics:</strong>
                <div class="code-block">
# Check Firebase Auth status
curl -X GET https://identitytoolkit.googleapis.com/v1/projects/journeyman-jobs-prod

# Verify auth configuration
firebase auth:export --project journeyman-jobs-prod

# Check recent auth settings changes in Firebase Console
# Go to Authentication ‚Üí Settings ‚Üí Authorized domains
                </div>
                
                <strong>Common Causes & Fixes:</strong>
                <ul>
                    <li><strong>Domain not authorized:</strong> Add domains in Firebase Console ‚Üí Authentication ‚Üí Settings</li>
                    <li><strong>API key invalid:</strong> Regenerate API keys in Firebase Console ‚Üí Project Settings</li>
                    <li><strong>Provider disabled:</strong> Re-enable Google/Apple sign-in providers</li>
                    <li><strong>Rate limiting:</strong> Check quota usage and increase limits</li>
                </ul>
            </div>
        </div>

        <div class="issue">
            <h3>üìß Email System Failure</h3>
            <p><strong>Symptoms:</strong> Job shares not being sent via email, users reporting missing notifications</p>
            <p><strong>Impact:</strong> Core job sharing feature unavailable</p>
            <p><strong>Priority:</strong> <span class="severity-critical">Critical</span></p>
            
            <div class="solution">
                <strong>Immediate Checks:</strong>
                <div class="code-block">
# Check SendGrid status
curl -X GET https://status.sendgrid.com/api/v2/status.json

# Verify SendGrid API key
curl -X GET https://api.sendgrid.com/v3/user/profile \
  -H "Authorization: Bearer $SENDGRID_API_KEY"

# Check function logs for email errors
firebase functions:log --filter="sendJobShareEmail" --limit 50
                </div>
                
                <strong>Resolution Steps:</strong>
                <ol>
                    <li>Verify SendGrid account isn't suspended or over quota</li>
                    <li>Check if API key has expired or been revoked</li>
                    <li>Verify email templates exist and are published</li>
                    <li>Check domain authentication (SPF, DKIM, DMARC records)</li>
                    <li>Test with alternative email service if SendGrid is down</li>
                </ol>
            </div>
        </div>

        <h2>‚ö†Ô∏è High Priority Issues</h2>

        <div class="issue">
            <h3>üì± Push Notifications Not Working</h3>
            <p><strong>Symptoms:</strong> Users not receiving notifications for shared jobs</p>
            <p><strong>Impact:</strong> Reduced user engagement and missed opportunities</p>
            <p><strong>Priority:</strong> <span class="severity-high">High</span></p>
            
            <div class="solution">
                <strong>Diagnostic Commands:</strong>
                <div class="code-block">
# Check FCM service status
curl -X POST https://fcm.googleapis.com/v1/projects/journeyman-jobs-prod/messages:send \
  -H "Authorization: Bearer $(gcloud auth print-access-token)" \
  -H "Content-Type: application/json" \
  -d '{
    "message": {
      "token": "test_token",
      "notification": {
        "title": "Test",
        "body": "Testing FCM"
      }
    }
  }'

# Check notification function logs
firebase functions:log --filter="sendPushNotification"
                </div>
                
                <strong>Common Solutions:</strong>
                <ul>
                    <li><strong>Invalid FCM tokens:</strong> Implement token refresh mechanism</li>
                    <li><strong>Notification permissions:</strong> Guide users to enable notifications</li>
                    <li><strong>Background app restrictions:</strong> Advise users to whitelist the app</li>
                    <li><strong>Platform-specific issues:</strong> Check iOS/Android notification settings</li>
                </ul>
            </div>
        </div>

        <div class="issue">
            <h3>‚ö° Severe Performance Issues</h3>
            <p><strong>Symptoms:</strong> App extremely slow, timeouts, high memory usage</p>
            <p><strong>Impact:</strong> Poor user experience, potential app crashes</p>
            <p><strong>Priority:</strong> <span class="severity-high">High</span></p>
            
            <div class="solution">
                <strong>Performance Analysis:</strong>
                <div class="code-block">
# Check function execution times
firebase functions:log --filter="execution took" --limit 50

# Monitor database queries
# Go to Firestore ‚Üí Usage tab in Firebase Console

# Check memory usage patterns
gcloud logging read "resource.type=cloud_function" --limit=50 --format=json | \
  jq '.[] | select(.jsonPayload.memoryUsed != null) | .jsonPayload.memoryUsed'
                </div>
                
                <strong>Optimization Actions:</strong>
                <ol>
                    <li>Identify slow Firestore queries and add appropriate indexes</li>
                    <li>Implement caching for frequently accessed data</li>
                    <li>Optimize image loading and implement lazy loading</li>
                    <li>Review and optimize widget rebuilds in Flutter</li>
                    <li>Consider increasing Cloud Function memory allocation</li>
                </ol>
            </div>
        </div>

        <h2>üîß Medium Priority Issues</h2>

        <div class="issue">
            <h3>üìã Contact Picker Issues</h3>
            <p><strong>Symptoms:</strong> Contact picker crashes, doesn't load contacts, permission errors</p>
            <p><strong>Impact:</strong> Users cannot easily share jobs with contacts</p>
            <p><strong>Priority:</strong> <span class="severity-medium">Medium</span></p>
            
            <div class="solution">
                <strong>Investigation Steps:</strong>
                <ul>
                    <li>Check if contact permissions are properly requested and granted</li>
                    <li>Verify contacts_service plugin compatibility with OS versions</li>
                    <li>Test on different devices and OS versions</li>
                    <li>Check for privacy policy compliance requirements</li>
                </ul>
                
                <strong>Fallback Solution:</strong>
                <div class="code-block">
// Implement manual email entry as fallback
if (contactsAccessFailed) {
  showManualEmailEntry();
}
                </div>
            </div>
        </div>

        <div class="issue">
            <h3>üîó Deep Links Not Working</h3>
            <p><strong>Symptoms:</strong> Shared job links don't open in app, redirect to browser instead</p>
            <p><strong>Impact:</strong> Poor user experience when accessing shared jobs</p>
            <p><strong>Priority:</strong> <span class="severity-medium">Medium</span></p>
            
            <div class="solution">
                <strong>Validation Checklist:</strong>
                <ul>
                    <li>Verify universal links configuration in iOS</li>
                    <li>Check Android App Links verification</li>
                    <li>Test deep link handling in app router</li>
                    <li>Verify domain verification files are accessible</li>
                </ul>
                
                <strong>Testing Commands:</strong>
                <div class="code-block">
# Test iOS universal links
xcrun simctl openurl booted "https://journeymanjobs.com/share/test123"

# Test Android deep links
adb shell am start -W -a android.intent.action.VIEW \
  -d "https://journeymanjobs.com/share/test123" \
  com.journeymanjobs.app
                </div>
            </div>
        </div>

        <h2>üìä Monitoring & Diagnostic Tools</h2>

        <h3>Key Monitoring Dashboards</h3>
        <table>
            <tr>
                <th>Service</th>
                <th>URL</th>
                <th>Key Metrics</th>
            </tr>
            <tr>
                <td>Firebase Console</td>
                <td>https://console.firebase.google.com/project/journeyman-jobs-prod</td>
                <td>Functions, Auth, Firestore, Analytics</td>
            </tr>
            <tr>
                <td>Cloud Functions Logs</td>
                <td>Functions ‚Üí Logs in Firebase Console</td>
                <td>Errors, execution time, memory usage</td>
            </tr>
            <tr>
                <td>SendGrid Dashboard</td>
                <td>https://app.sendgrid.com</td>
                <td>Email delivery, bounces, blocks</td>
            </tr>
            <tr>
                <td>App Store Connect</td>
                <td>https://appstoreconnect.apple.com</td>
                <td>iOS crashes, reviews, usage</td>
            </tr>
            <tr>
                <td>Google Play Console</td>
                <td>https://play.google.com/console</td>
                <td>Android crashes, ANRs, reviews</td>
            </tr>
        </table>

        <h3>Essential Diagnostic Commands</h3>
        <div class="code-block">
# Check overall system health
firebase functions:log --limit 20
firebase auth:export users.json --project journeyman-jobs-prod
gcloud projects list --filter="projectId:journeyman-jobs-prod"

# Monitor real-time errors
firebase functions:log --filter="ERROR" --follow

# Check function performance
gcloud logging read "resource.type=cloud_function 
  AND resource.labels.function_name=sendJobShareEmail" 
  --limit=10 --format=json

# Verify Firestore rules
firebase firestore:rules:get --project journeyman-jobs-prod

# Test API endpoints
curl -X GET https://us-central1-journeyman-jobs-prod.cloudfunctions.net/api/health
        </div>

        <h2>üîÑ Recovery Procedures</h2>

        <div class="alert alert-info">
            <h3>Standard Recovery Process</h3>
            <ol>
                <li><strong>Assess Impact:</strong> Determine severity and affected users</li>
                <li><strong>Immediate Mitigation:</strong> Apply hotfixes or rollbacks</li>
                <li><strong>Communication:</strong> Notify team and stakeholders</li>
                <li><strong>Root Cause Analysis:</strong> Identify underlying issue</li>
                <li><strong>Permanent Fix:</strong> Implement proper solution</li>
                <li><strong>Prevention:</strong> Update monitoring and tests</li>
            </ol>
        </div>

        <h3>Emergency Rollback Procedures</h3>
        <div class="code-block">
# Rollback Cloud Functions
firebase functions:delete functionName --project journeyman-jobs-prod
firebase deploy --only functions --project journeyman-jobs-prod

# Rollback Firestore Rules
git checkout HEAD~1 firebase/firestore.rules
firebase deploy --only firestore:rules --project journeyman-jobs-prod

# Rollback mobile app (App Store/Play Store)
# iOS: App Store Connect ‚Üí App Store ‚Üí iOS App ‚Üí App Information ‚Üí Reset
# Android: Play Console ‚Üí Release ‚Üí Production ‚Üí Release details ‚Üí Rollback

# Emergency feature flags
firebase functions:config:set feature.email_sharing=false
firebase functions:config:set feature.sms_sharing=false
firebase deploy --only functions --project journeyman-jobs-prod
        </div>

        <h2>üìû Escalation Matrix</h2>

        <table>
            <tr>
                <th>Issue Type</th>
                <th>First Contact</th>
                <th>Escalation 1</th>
                <th>Escalation 2</th>
            </tr>
            <tr>
                <td>Authentication Issues</td>
                <td>Technical Lead</td>
                <td>Firebase Specialist</td>
                <td>Security Team</td>
            </tr>
            <tr>
                <td>Email/SMS Issues</td>
                <td>Backend Developer</td>
                <td>Technical Lead</td>
                <td>External Service Support</td>
            </tr>
            <tr>
                <td>Mobile App Crashes</td>
                <td>Mobile Developer</td>
                <td>Technical Lead</td>
                <td>Platform Support (Apple/Google)</td>
            </tr>
            <tr>
                <td>Security Incidents</td>
                <td>Security Team</td>
                <td>CISO</td>
                <td>Legal Team</td>
            </tr>
            <tr>
                <td>Data Privacy Issues</td>
                <td>Data Protection Officer</td>
                <td>Legal Team</td>
                <td>IBEW Technical Coordinator</td>
            </tr>
        </table>

        <div class="alert alert-success">
            <h3>üéØ Best Practices for Issue Resolution</h3>
            <ul>
                <li><strong>Document Everything:</strong> Keep detailed logs of all troubleshooting steps</li>
                <li><strong>Test Fixes:</strong> Always test in staging before applying to production</li>
                <li><strong>Communicate Proactively:</strong> Keep stakeholders informed throughout the process</li>
                <li><strong>Learn and Improve:</strong> Conduct post-incident reviews and update monitoring</li>
                <li><strong>Maintain Calm:</strong> Methodical troubleshooting prevents additional issues</li>
            </ul>
        </div>

        <div style="margin-top: 40px; padding: 20px; background-color: #f8f9fa; border-radius: 5px;">
            <h3>üìö Additional Resources</h3>
            <ul>
                <li><strong>Firebase Documentation:</strong> <a href="https://firebase.google.com/docs">firebase.google.com/docs</a></li>
                <li><strong>Flutter Troubleshooting:</strong> <a href="https://flutter.dev/docs/testing/debugging">flutter.dev/docs/testing/debugging</a></li>
                <li><strong>SendGrid Support:</strong> <a href="https://sendgrid.com/docs">sendgrid.com/docs</a></li>
                <li><strong>IBEW Technical Resources:</strong> Contact IBEW Technical Coordinator for union-specific guidance</li>
            </ul>
        </div>
    </div>
</body>
</html>