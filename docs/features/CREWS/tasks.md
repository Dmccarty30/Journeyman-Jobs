# Tasks: Crews Communication Hub

**Input**: Design documents from `docs/features/Crews/`
**Prerequisites**: plan.md âœ“, research.md âœ“, data-model.md âœ“, contracts/ âœ“, quickstart.md âœ“

## Execution Flow (main)

```dart
1. Load plan.md from feature directory âœ“
   â†’ Tech stack: Flutter 3.x/Dart 3.0+, Firebase (Firestore, FCM), Riverpod
   â†’ Structure: lib/features/crews/ with models/, providers/, services/, screens/, widgets/
2. Load design documents âœ“:
   â†’ data-model.md: 13 entities extracted â†’ model tasks
   â†’ contracts/: 11 API endpoints â†’ service and integration tests
   â†’ quickstart.md: 6 user flows â†’ integration tests
3. Generate tasks by category:
   â†’ Setup: Firebase rules, dependencies, project structure
   â†’ Tests: Contract tests, integration tests, widget tests
   â†’ Core: Models, services, providers, screens
   â†’ Integration: Navigation, existing service integration
   â†’ Polish: Unit tests, performance, documentation
4. Apply TDD rules:
   â†’ Tests before implementation (constitutional requirement)
   â†’ [P] for different files with no dependencies
   â†’ Sequential for same file modifications
5. Number tasks T001-T047 with dependency tracking
```

## Format: `[ID] [P?] Description`

- **[P]**: Can run in parallel (different files, no dependencies)
- File paths follow Flutter feature-based structure

## Phase 3.1: Setup & Configuration âœ… **COMPLETE**

- [x] **T001** Create lib/features/crews/ directory structure (models/, providers/, services/, screens/, widgets/) âœ…
- [x] **T002** Update pubspec.yaml with crew-specific dependencies (riverpod, firebase packages) âœ…
- [x] **T003** [P] Create firestore.rules for crew collections security âœ…
- [x] **T004** [P] Create functions/src/crews.js for Firebase Cloud Functions âœ…
- [x] **T005** [P] Update lib/navigation/app_router.dart to include crew routes âœ…

## Phase 3.2: Tests First (TDD) âœ… **COMPLETE**

- **CRITICAL: These tests MUST be written and MUST FAIL before ANY implementation** âœ… ALL TESTS WRITTEN AND FAILING

### Contract Tests (API Integration) âœ… **COMPLETE**

- [x] **T006** [P] Contract test POST /crews in test/features/crews/integration/crew_management_test.dart âœ…
- [x] **T007** [P] Contract test GET /crews in test/features/crews/integration/crew_management_test.dart âœ…
- [x] **T008** [P] Contract test POST /crews/{crewId}/members in test/features/crews/integration/crew_member_test.dart âœ…
- [x] **T009** [P] Contract test POST /crews/{crewId}/jobs in test/features/crews/integration/job_sharing_test.dart âœ…
- [x] **T010** [P] Contract test POST /crews/{crewId}/messages in test/features/crews/integration/crew_communication_test.dart âœ…

### Integration Tests (User Flows) âœ… **COMPLETE**

- [x] **T011** [P] Integration test: Create crew and invite members flow in test/features/crews/integration/crew_creation_flow_test.dart âœ…
- [x] **T012** [P] Integration test: Accept crew invitation flow in test/features/crews/integration/crew_invitation_flow_test.dart âœ…
- [x] **T013** [P] Integration test: Share job to crew flow in test/features/crews/integration/job_sharing_flow_test.dart âœ…
- [x] **T014** [P] Integration test: Crew communication flow in test/features/crews/integration/crew_messaging_flow_test.dart âœ…
- [x] **T015** [P] Integration test: Group job application coordination in test/features/crews/integration/group_bid_flow_test.dart âœ…
- [x] **T016** [P] Integration test: Member management and voting in test/features/crews/integration/member_management_flow_test.dart âœ…

### Widget Tests âœ… **COMPLETE**

- [x] **T017** [P] Widget test for CrewCard in test/features/crews/widgets/crew_card_test.dart âœ…
- [x] **T018** [P] Widget test for CrewListScreen in test/features/crews/screens/crew_list_screen_test.dart âœ…
- [x] **T019** [P] Widget test for CreateCrewScreen in test/features/crews/screens/create_crew_screen_test.dart âœ…

## Phase 3.3: Core Models âœ… **COMPLETE**

### Data Models âœ… **COMPLETE**

- [x] **T020** [P] Crew model in lib/features/crews/models/crew.dart âœ…
- [x] **T021** [P] CrewMember model in lib/features/crews/models/crew_member.dart âœ…
- [x] **T022** [P] JobNotification model in lib/features/crews/models/job_notification.dart âœ…
- [x] **T023** [P] GroupBid model in lib/features/crews/models/group_bid.dart âœ…
- [x] **T024** [P] CrewCommunication model in lib/features/crews/models/crew_communication.dart âœ…
- [x] **T025** [P] CrewPreferences model in lib/features/crews/models/crew_preferences.dart âœ…
- [x] **T026** [P] CrewStats model in lib/features/crews/models/crew_stats.dart âœ…

### Enums and Supporting Classes âœ… **COMPLETE**

- [x] **T027** [P] CrewRole, ResponseType, GroupBidStatus enums in lib/features/crews/models/crew_enums.dart âœ…
- [x] **T028** [P] MessageType, AttachmentType, JobType enums in lib/features/crews/models/crew_enums.dart âœ…

## Phase 3.4: Services & Business Logic âœ… **COMPLETE**

- [x] **T029** CrewService core CRUD operations in lib/features/crews/services/crew_service.dart âœ…
- [x] **T030** CrewMemberService for member management in lib/features/crews/services/crew_member_service.dart âœ…
- [x] **T031** CrewCommunicationService for messaging in lib/features/crews/services/crew_communication_service.dart âœ…
- [x] **T032** Extend JobSharingService for crew job sharing in lib/services/job_sharing_service.dart âœ…

## Phase 3.5: State Management (Riverpod Providers) âœ… **COMPLETE**

- [x] **T033** [P] CrewProvider for crew state management in lib/features/crews/providers/crew_provider.dart âœ…
- [x] **T034** [P] CrewMemberProvider for member state in lib/features/crews/providers/crew_member_provider.dart âœ…
- [x] **T035** [P] CrewCommunicationProvider for messaging state in lib/features/crews/providers/crew_communication_provider.dart âœ…

## Phase 3.6: UI Implementation âœ… **COMPLETE**

### Core Widgets âœ… **COMPLETE**

- [x] **T036** [P] CrewCard widget in lib/features/crews/widgets/crew_card.dart âœ…
- [x] **T037** [P] CrewMemberCard widget in lib/features/crews/widgets/crew_member_card.dart âœ…
- [x] **T038** [P] JobNotificationCard widget in lib/features/crews/widgets/job_notification_card.dart âœ…
- [x] **T039** [P] MessageBubble widget in lib/features/crews/widgets/message_bubble.dart âœ…

### Screens âœ… **COMPLETE**

- [x] **T040** CrewListScreen in lib/features/crews/screens/crew_list_screen.dart âœ…
- [x] **T041** CreateCrewScreen in lib/features/crews/screens/create_crew_screen.dart âœ…
- [x] **T042** CrewDetailScreen in lib/features/crews/screens/crew_detail_screen.dart âœ…
- [x] **T043** CrewCommunicationScreen in lib/features/crews/screens/crew_communication_screen.dart âœ…

## Phase 3.7: Integration & Navigation ðŸ”„ **IN PROGRESS**

- [ ] **T044** Update main navigation to include Crews tab in lib/navigation/app_router.dart
- [ ] **T045** Connect crew job sharing with existing job sharing flow in lib/services/job_sharing_service.dart
- [ ] **T046** Firebase Cloud Functions deployment and crew notification triggers

## Phase 3.8: Polish & Validation

- [ ] **T047** [P] Run quickstart.md validation flows and fix any issues

## Dependencies

```dart
Setup (T001-T005) â†’ Tests (T006-T019) â†’ Models (T020-T028) â†’ Services (T029-T032) â†’ Providers (T033-T035) â†’ Widgets (T036-T039) â†’ Screens (T040-T043) â†’ Integration (T044-T046) â†’ Polish (T047)

Critical Blocking Dependencies:
- T029 (CrewService) blocks T033 (CrewProvider)
- T033 (CrewProvider) blocks T040 (CrewListScreen)
- T020-T028 (Models) block all Services T029-T032
- T006-T019 (Tests) must complete before any implementation
```

## Parallel Execution Examples

### Phase 3.2 - Contract Tests (Can run simultaneously)

```bash
# Launch T006-T010 together:
Task: "Contract test POST /crews in test/features/crews/integration/crew_management_test.dart"
Task: "Contract test GET /crews in test/features/crews/integration/crew_management_test.dart"
Task: "Contract test POST /crews/{crewId}/members in test/features/crews/integration/crew_member_test.dart"
Task: "Contract test POST /crews/{crewId}/jobs in test/features/crews/integration/job_sharing_test.dart"
Task: "Contract test POST /crews/{crewId}/messages in test/features/crews/integration/crew_communication_test.dart"
```

### Phase 3.3 - Data Models (Can run simultaneously)

```bash
# Launch T020-T028 together:
Task: "Crew model in lib/features/crews/models/crew.dart"
Task: "CrewMember model in lib/features/crews/models/crew_member.dart"
Task: "JobNotification model in lib/features/crews/models/job_notification.dart"
Task: "GroupBid model in lib/features/crews/models/group_bid.dart"
Task: "CrewCommunication model in lib/features/crews/models/crew_communication.dart"
```

### Phase 3.5 - Riverpod Providers (Can run simultaneously)

```bash
# Launch T033-T035 together:
Task: "CrewProvider for crew state management in lib/features/crews/providers/crew_provider.dart"
Task: "CrewMemberProvider for member state in lib/features/crews/providers/crew_member_provider.dart"
Task: "CrewCommunicationProvider for messaging state in lib/features/crews/providers/crew_communication_provider.dart"
```

## Validation Checklist

- *GATE: Must be checked before implementation complete*

- [x] All API contracts have corresponding tests (T006-T010)
- [x] All entities have model tasks (T020-T028)
- [x] All user flows have integration tests (T011-T016)
- [x] All tests come before implementation (T006-T019 before T020+)
- [x] Parallel tasks are truly independent (different files)
- [x] Each task specifies exact file path
- [x] TDD order enforced: Tests â†’ Models â†’ Services â†’ Providers â†’ UI
- [x] No task modifies same file as another [P] task
- [x] All quickstart.md flows have validation tasks

## Notes

- [P] tasks target different files with no shared dependencies
- Verify ALL tests fail before implementing (T006-T019)
- Commit after each completed task
- Follow existing electrical theme patterns from design_system/
- Maintain consistency with existing job_sharing feature patterns
- Firebase emulator suite required for realistic testing
- Real-time Firestore listeners essential for crew communication
- Offline capabilities required for field worker use cases

## Task Generation Rules Applied

- *Rules applied during task generation*

1. **From Contracts** âœ“:
   - 11 API endpoints â†’ 5 contract test tasks (T006-T010)
   - Each endpoint group â†’ dedicated service implementation

2. **From Data Model** âœ“:
   - 13 entities â†’ 9 model creation tasks (T020-T028)
   - Related entities grouped for dependency management

3. **From Quickstart User Stories** âœ“:
   - 6 user flows â†’ 6 integration test tasks (T011-T016)
   - Each flow mapped to specific test scenarios

4. **TDD Ordering** âœ“:
   - Setup â†’ Contract Tests â†’ Integration Tests â†’ Models â†’ Services â†’ UI
   - Constitutional requirement: All tests before implementation
