<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journeyman Jobs - Crews Feature Comprehensive Analysis</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #1A202C;
        }
        .electrical-theme {
            color: #B45309;
            font-weight: bold;
        }
        h1 {
            color: #1A202C;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        h2 {
            color: #1A202C;
            border-left: 4px solid #B45309;
            padding-left: 15px;
            margin-top: 40px;
            margin-bottom: 20px;
        }
        h3 {
            color: #1A202C;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        .highlight {
            background: linear-gradient(120deg, #B45309 0%, #1A202C 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
        .model-diagram {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .stats-table th, .stats-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        .stats-table th {
            background: #1A202C;
            color: white;
            font-weight: 600;
        }
        .stats-table tr:hover {
            background: #f8f9fa;
        }
        .warning-box {
            background: linear-gradient(145deg, #fff3cd, #ffeaa7);
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #f39c12;
        }
        .success-box {
            background: linear-gradient(145deg, #d4edda, #a8e6cf);
            border: 1px solid #a8e6cf;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }
        .info-box {
            background: linear-gradient(145deg, #d1ecf1, #81ecec);
            border: 1px solid #81ecec;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #17a2b8;
        }
        .architecture-diagram {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }
        .layer {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .flow-arrow {
            font-size: 24px;
            color: #1A202C;
            margin: 10px 0;
        }
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
            padding: 5px;
            margin-bottom: 0;
        }
        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .nav-tab:hover {
            background: #e9ecef;
        }
        .nav-tab.active {
            background: #1A202C;
            color: white;
        }
        .tab-content {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 0 0 8px 8px;
            padding: 25px;
            margin-top: -1px;
        }
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #B45309;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #B45309;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 20px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #B45309;
            border: 2px solid white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîå Journeyman Jobs - Crews Feature</h1>
            <h2 class="electrical-theme">Comprehensive Analysis Report</h2>
            <p><em>Complete technical documentation for the IBEW electrical workers crew management system</em></p>
        </div>

        <div class="info-box">
            <strong>üìã Executive Summary:</strong> The crews feature is a comprehensive crew management system designed specifically for IBEW electrical workers. It enables foremen to create and manage crews, invite members, share job opportunities, and communicate through real-time messaging. The system implements role-based permissions, offline capabilities, and extensive electrical theming throughout the UI.
        </div>

        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">Overview</button>
            <button class="nav-tab" onclick="showTab('architecture')">Architecture</button>
            <button class="nav-tab" onclick="showTab('data-models')">Data Models</button>
            <button class="nav-tab" onclick="showTab('services')">Services</button>
            <button class="nav-tab" onclick="showTab('ui-components')">UI Components</button>
            <button class="nav-tab" onclick="showTab('security')">Security</button>
            <button class="nav-tab" onclick="showTab('performance')">Performance</button>
        </nav>

        <div id="overview" class="tab-content">
            <h2>üìä Feature Overview</h2>

            <div class="feature-grid">
                <div class="feature-card">
                    <h3>üèóÔ∏è Crew Management</h3>
                    <p>Create, configure, and manage electrical work crews with role-based permissions and member limits.</p>
                    <ul>
                        <li>Crew creation with validation</li>
                        <li>Member invitation system</li>
                        <li>Role-based access control</li>
                        <li>Crew preferences and settings</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h3>üí¨ Real-time Messaging</h3>
                    <p>Instant communication between crew members with push notifications and media sharing.</p>
                    <ul>
                        <li>Real-time message streaming</li>
                        <li>Message reactions and replies</li>
                        <li>Read status tracking</li>
                        <li>Media and location sharing</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h3>üíº Job Sharing</h3>
                    <p>Share job opportunities within crews with matching algorithms and application tracking.</p>
                    <ul>
                        <li>Job-to-crew matching</li>
                        <li>Application tracking</li>
                        <li>Success analytics</li>
                        <li>Auto-sharing preferences</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h3>‚ö° Electrical Theme</h3>
                    <p>Consistent electrical industry theming with circuit patterns and professional design.</p>
                    <ul>
                        <li>Circuit pattern backgrounds</li>
                        <li>Electrical color schemes</li>
                        <li>Professional iconography</li>
                        <li>Industry-specific terminology</li>
                    </ul>
                </div>
            </div>

            <h3>üéØ Key Capabilities</h3>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Capability</th>
                        <th>Description</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Crew Creation</td>
                        <td>Foremen can create crews with custom names, logos, and preferences</td>
                        <td>‚úÖ Implemented</td>
                    </tr>
                    <tr>
                        <td>Member Management</td>
                        <td>Invite, remove, and manage crew members with role assignments</td>
                        <td>‚úÖ Implemented</td>
                    </tr>
                    <tr>
                        <td>Real-time Chat</td>
                        <td>Instant messaging with reactions, replies, and media sharing</td>
                        <td>‚úÖ Implemented</td>
                    </tr>
                    <tr>
                        <td>Job Matching</td>
                        <td>Automatic job-to-crew matching based on preferences</td>
                        <td>‚úÖ Implemented</td>
                    </tr>
                    <tr>
                        <td>Offline Support</td>
                        <td>Full offline functionality with automatic sync</td>
                        <td>‚úÖ Implemented</td>
                    </tr>
                    <tr>
                        <td>Permission System</td>
                        <td>Role-based permissions (Foreman, Lead, Member)</td>
                        <td>‚ö†Ô∏è Development Mode</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="architecture" class="tab-content" style="display: none;">
            <h2>üèõÔ∏è System Architecture</h2>

            <div class="architecture-diagram">
                <div class="layer">
                    <h3>üé® UI Layer (Flutter Widgets)</h3>
                    <p>CrewChatScreen ‚Ä¢ CrewInvitationsScreen ‚Ä¢ CrewSelectionDropdown</p>
                </div>
                <div class="flow-arrow">‚Üì</div>
                <div class="layer">
                    <h3>üîÑ State Management (Riverpod)</h3>
                    <p>CrewsRiverpodProvider ‚Ä¢ CrewSelectionProvider ‚Ä¢ CrewMessagesProvider</p>
                </div>
                <div class="flow-arrow">‚Üì</div>
                <div class="layer">
                    <h3>‚öôÔ∏è Service Layer</h3>
                    <p>CrewService ‚Ä¢ CrewMessagingService ‚Ä¢ JobSharingService ‚Ä¢ JobMatchingService</p>
                </div>
                <div class="flow-arrow">‚Üì</div>
                <div class="layer">
                    <h3>üóÑÔ∏è Data Layer (Firebase)</h3>
                    <p>Firestore Database ‚Ä¢ Authentication ‚Ä¢ Storage ‚Ä¢ Cloud Functions</p>
                </div>
            </div>

            <h3>üîó Component Relationships</h3>
            <div class="model-diagram">
                <h4>Crew Management Flow</h4>
                <div style="font-family: monospace; text-align: left; display: inline-block;">
                    User ‚Üí AuthProvider ‚Üí CrewService ‚Üí Firestore<br>
                    ‚Üì<br>
                    Riverpod ‚Üí State Updates ‚Üí UI Rebuild<br>
                    ‚Üì<br>
                    Real-time Streams ‚Üí Live Updates<br>
                    ‚Üì<br>
                    Offline Service ‚Üí Local Cache ‚Üí Sync When Online
                </div>
            </div>

            <h3>üìã Key Architectural Decisions</h3>
            <div class="success-box">
                <strong>‚úÖ Excellent Decisions:</strong>
                <ul>
                    <li><strong>Riverpod State Management:</strong> Modern, reactive state management with automatic dependency tracking</li>
                    <li><strong>Service Layer Separation:</strong> Clear separation between business logic and UI</li>
                    <li><strong>Offline-First Architecture:</strong> Robust offline support with automatic synchronization</li>
                    <li><strong>Real-time Streams:</strong> Live updates using Firestore streams</li>
                    <li><strong>Type Safety:</strong> Comprehensive model definitions with validation</li>
                </ul>
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Areas for Improvement:</strong>
                <ul>
                    <li><strong>Permission System:</strong> Currently disabled in development mode - needs re-enablement</li>
                    <li><strong>Error Boundaries:</strong> Limited error handling at UI level</li>
                    <li><strong>Caching Strategy:</strong> Basic caching - could be enhanced with smart invalidation</li>
                </ul>
            </div>
        </div>

        <div id="data-models" class="tab-content" style="display: none;">
            <h2>üìä Data Models & Relationships</h2>

            <h3>üèóÔ∏è Core Crew Model</h3>
            <div class="code-block">
Crew {
  id: String                    // Unique identifier
  name: String                  // Crew display name
  logoUrl: String?              // Optional crew logo
  foremanId: String             // Crew foreman user ID
  memberIds: List&lt;String&gt;     // All member IDs
  location: CrewLocation?       // Optional location
  preferences: CrewPreferences   // Crew preferences
  stats: CrewStats              // Analytics data
  isActive: bool               // Active status
  createdAt: DateTime          // Creation timestamp
  updatedAt: DateTime?         // Last update
  roles: Map&lt;String, MemberRole&gt; // Member roles
  memberCount: int             // Total member count
  lastActivityAt: DateTime      // Last activity
  visibility: CrewVisibility   // Public/Private
  maxMembers: int              // Maximum members
  activeInviteCode: String?    // Current invite code
  inviteCodeCounter: int        // Invite generation counter
}
            </div>

            <h3>üë• Crew Member Model</h3>
            <div class="code-block">
CrewMember {
  userId: String                // User reference
  crewId: String                // Crew reference
  role: MemberRole              // Member role
  joinedAt: DateTime            // Join timestamp
  permissions: MemberPermissions // Granular permissions
  isAvailable: bool             // Availability status
  customTitle: String?          // Optional custom title
  lastActive: DateTime          // Last activity
  isActive: bool               // Active status
}
            </div>

            <h3>üì® Crew Message Model</h3>
            <div class="code-block">
CrewMessage {
  id: String                    // Message ID
  crewId: String                // Crew reference
  senderId: String              // Sender user ID
  senderName: String            // Sender display name
  senderAvatarUrl: String?      // Sender avatar
  content: String               // Message content
  type: CrewMessageType         // Message type
  priority: CrewMessagePriority  // Priority level
  createdAt: Timestamp          // Creation time
  mediaUrls: List&lt;String&gt;      // Media attachments
  metadata: Map&lt;String, dynamic&gt; // Type-specific data
  readStatus: List&lt;MessageReadStatus&gt; // Read tracking
  replyToMessageId: String?     // Reply reference
  reactions: Map&lt;String, String&gt; // Emoji reactions
  editedAt: Timestamp?          // Edit timestamp
  isDeleted: bool               // Soft delete flag
  isUrgent: bool               // Urgent flag
}
            </div>

            <h3>üîê Permission Matrix</h3>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Role</th>
                        <th>Invite</th>
                        <th>Remove</th>
                        <th>Share Jobs</th>
                        <th>Post Announcements</th>
                        <th>Edit Crew</th>
                        <th>View Analytics</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Foreman</strong></td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                    </tr>
                    <tr>
                        <td><strong>Lead</strong></td>
                        <td>‚úÖ</td>
                        <td>‚ùå</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                        <td>‚ùå</td>
                        <td>‚ùå</td>
                    </tr>
                    <tr>
                        <td><strong>Member</strong></td>
                        <td>‚ùå</td>
                        <td>‚ùå</td>
                        <td>‚ùå</td>
                        <td>‚ùå</td>
                        <td>‚ùå</td>
                        <td>‚ùå</td>
                    </tr>
                </tbody>
            </table>

            <h3>üîó Model Relationships</h3>
            <div class="model-diagram">
                <div style="text-align: left; display: inline-block;">
                    <strong>Crew</strong> 1 ‚Üê‚Üí * <strong>CrewMember</strong><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;‚Üì<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;1 ‚Üê‚Üí * <strong>CrewMessage</strong><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;‚Üì<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;1 ‚Üê‚Üí * <strong>CrewInvitation</strong><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;‚Üì<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;1 ‚Üê‚Üí * <strong>CrewStats</strong><br>
                    <br>
                    <strong>User</strong> 1 ‚Üê‚Üí * <strong>CrewMember</strong><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;‚Üì<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;1 ‚Üê‚Üí * <strong>CrewInvitation</strong>
                </div>
            </div>
        </div>

        <div id="services" class="tab-content" style="display: none;">
            <h2>‚öôÔ∏è Services Layer</h2>

            <h3>üèóÔ∏è CrewService</h3>
            <p>Primary service for crew management operations with comprehensive business logic.</p>

            <h4>Key Methods:</h4>
            <div class="code-block">
// Core Operations
createCrew({name, foremanId, preferences, logoUrl})
getCrew(String crewId)
updateCrew({crewId, name, logoUrl, preferences})
deleteCrew(String crewId)

// Member Management
inviteMember({crewId, inviterId, inviteeId, role, message})
removeMember({crewId, userId, inviterId})
updateMemberRole({crewId, userId, role, updaterId})

// Invitation Management
acceptInvitation({invitationId, crewId, userId})
rejectInvitation({invitationId, crewId, userId})
cancelInvitation({invitationId, crewId, inviterId})
getPendingInvitations(String userId)

// Statistics & Analytics
updateCrewStats(String crewId)
incrementApplication(String crewId)
incrementJobShared(String crewId)
incrementSuccessfulPlacement(String crewId)
            </div>

            <div class="success-box">
                <strong>‚úÖ Advanced Features:</strong>
                <ul>
                    <li><strong>Rate Limiting:</strong> Crew creation (3 per user), invitations (5 per day, 100 lifetime)</li>
                    <li><strong>Retry Logic:</strong> Exponential backoff for failed operations</li>
                    <li><strong>Offline Support:</strong> Full offline operations with sync</li>
                    <li><strong>Validation:</strong> Comprehensive input validation and error handling</li>
                    <li><strong>Transaction Safety:</strong> Firestore transactions for data consistency</li>
                </ul>
            </div>

            <h3>üí¨ CrewMessagingService</h3>
            <p>Real-time messaging service with advanced features and push notifications.</p>

            <h4>Core Capabilities:</h4>
            <div class="code-block">
// Message Operations
sendMessage({crewId, sender, content, type, priority, mediaUrls})
sendSystemMessage({crewId, content, metadata})
getMessages({crewId, limit, lastMessage})
searchMessages({crewId, query, limit})

// Message Management
markMessageAsRead(String messageId, String userId)
markAllMessagesAsRead(String crewId, String userId)
editMessage(String messageId, String userId, newContent)
deleteMessage(String messageId, String userId)

// Reactions & Engagement
addReaction(String messageId, String userId, String emoji)
removeReaction(String messageId, String userId)

// Real-time Streaming
streamMessages(String crewId)
streamConversationsForUser(String userId)
streamUnreadCount(String crewId, String userId)
            </div>

            <h3>üíº Job Services</h3>

            <h4>JobSharingService:</h4>
            <ul>
                <li>Share jobs to specific crews</li>
                <li>Batch job sharing operations</li>
                <li>Job preference matching</li>
                <li>Sharing analytics and tracking</li>
            </ul>

            <h4>JobMatchingService:</h4>
            <ul>
                <li>Automatic job-to-crew matching</li>
                <li>Preference-based filtering</li>
                <li>Real-time job matching streams</li>
                <li>Match scoring algorithms</li>
            </ul>

            <h3>üîß Supporting Services</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>OfflineDataService</h4>
                    <p>Manages local storage and synchronization for offline operation.</p>
                </div>

                <div class="feature-card">
                    <h4>ConnectivityService</h4>
                    <p>Monitors network status and manages online/offline transitions.</p>
                </div>

                <div class="feature-card">
                    <h4>ValidationService</h4>
                    <p>Centralized validation for all data inputs and business rules.</p>
                </div>

                <div class="feature-card">
                    <h4>NotificationService</h4>
                    <p>Handles push notifications and in-app messaging.</p>
                </div>
            </div>
        </div>

        <div id="ui-components" class="tab-content" style="display: none;">
            <h2>üé® UI Components & Screens</h2>

            <h3>üì± Primary Screens</h3>

            <h4>CrewChatScreen</h4>
            <p>Real-time messaging interface with electrical theming.</p>
            <div class="code-block">
Features:
- Real-time message streaming
- Message composition with rich text
- Media attachment support
- Reply threading
- Message reactions
- Read status indicators
- Crew member display
- Electrical themed UI with circuit patterns
            </div>

            <h4>CrewInvitationsScreen</h4>
            <p>Manages crew invitations with status tracking.</p>
            <ul>
                <li>Received invitations with accept/reject</li>
                <li>Sent invitations with status tracking</li>
                <li>Invitation history</li>
                <li>Expiration handling</li>
            </ul>

            <h3>üß© Reusable Components</h3>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>CrewSelectionDropdown</h4>
                    <p>Dropdown for selecting active crew with search and filtering.</p>
                </div>

                <div class="feature-card">
                    <h4>CrewMemberAvatar</h4>
                    <p>Avatar component for crew members with status indicators.</p>
                </div>

                <div class="feature-card">
                    <h4>CrewMessageBubble</h4>
                    <p>Message bubble with reactions, replies, and status indicators.</p>
                </div>

                <div class="feature-card">
                    <h4>CrewInvitationCard</h4>
                    <p>Card component for displaying invitation details and actions.</p>
                </div>
            </div>

            <h3>‚ö° Electrical Theme Implementation</h3>
            <div class="info-box">
                <strong>Theme Colors:</strong>
                <ul>
                    <li><strong>Primary Navy:</strong> #1A202C - Professional electrical industry color</li>
                    <li><strong>Accent Copper:</strong> #B45309 - Electrical wire/connector color</li>
                    <li><strong>Success Green:</strong> #28a745 - Power-on/connected status</li>
                    <li><strong>Warning Amber:</strong> #ffc107 - Alert/caution status</li>
                </ul>
            </div>

            <h4>Visual Elements:</h4>
            <ul>
                <li><strong>CircuitPatternPainter:</strong> Background circuit pattern rendering</li>
                <li><strong>JJElectricalLoader:</strong> Themed loading animations</li>
                <li><strong>ElectricalGradient:</strong> Navy to copper gradient effects</li>
                <li><strong>Circuit Icons:</strong> Industry-specific iconography</li>
            </ul>

            <h3>üìä State Management Integration</h3>
            <p>All UI components are tightly integrated with Riverpod providers for reactive state management:</p>
            <div class="code-block">
// Provider consumption example
final crews = ref.watch(userCrewsProvider);
final currentCrew = ref.watch(selectedCrewProvider);
final members = ref.watch(crewMembersProvider(currentCrew?.id ?? ''));
final messages = ref.watch(crewMessagesStreamProvider(currentCrew?.id ?? ''));
            </div>
        </div>

        <div id="security" class="tab-content" style="display: none;">
            <h2>üîí Security & Permissions</h2>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Development Mode Notice:</strong>
                <p>Currently, the permission system is disabled for development testing. All authenticated users have unrestricted access to crew operations. This must be re-enabled before production deployment.</p>
            </div>

            <h3>üõ°Ô∏è Permission System Design</h3>

            <h4>Role-Based Access Control (RBAC)</h4>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Role</th>
                        <th>Permissions</th>
                        <th>Use Case</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Foreman</strong></td>
                        <td>Full control (create, update, delete, invite, remove)</td>
                        <td>Crew owner/manager</td>
                    </tr>
                    <tr>
                        <td><strong>Lead</strong></td>
                        <td>Limited permissions (invite, moderate, view stats)</td>
                        <td>Senior member, supervisor</td>
                    </tr>
                    <tr>
                        <td><strong>Member</strong></td>
                        <td>Basic permissions (view, participate)</td>
                        <td>Regular crew member</td>
                    </tr>
                </tbody>
            </table>

            <h4>Permission Matrix Implementation</h4>
            <div class="code-block">
enum Permission {
  createCrew,        // Create new crews
  updateCrew,        // Update crew information
  deleteCrew,        // Delete crews
  inviteMember,      // Invite new members
  removeMember,      // Remove members
  updateRole,        // Change member roles
  shareJob,          // Share jobs to crew
  moderateContent,   // Moderate messages
  viewStats,         // View analytics
  manageSettings,    // Manage crew settings
}

class RolePermissions {
  static const Map&lt;MemberRole, Set&lt;Permission&gt;&gt; permissions = {
    MemberRole.foreman: { /* All permissions */ },
    MemberRole.lead: { /* Limited permissions */ },
    MemberRole.member: { /* Basic permissions */ },
  };
}
            </div>

            <h3>üîê Authentication & Authorization</h3>

            <h4>Multi-Layer Security:</h4>
            <ol>
                <li><strong>Client-Side Validation:</strong> Permission checks before API calls</li>
                <li><strong>Service-Side Authorization:</strong> Server permission validation</li>
                <li><strong>Firestore Security Rules:</strong> Database-level access control</li>
                <li><strong>Token-Based Authentication:</strong> Firebase Auth with token refresh</li>
            </ol>

            <h4>Defense-in-Depth Implementation:</h4>
            <div class="success-box">
                <strong>‚úÖ Security Features:</strong>
                <ul>
                    <li><strong>Input Validation:</strong> Comprehensive validation for all user inputs</li>
                    <li><strong>Rate Limiting:</strong> Prevent abuse with request limits</li>
                    <li><strong>Token Refresh:</strong> Automatic token refresh with retry logic</li>
                    <li><strong>Permission Gates:</strong> Multiple validation layers</li>
                    <li><strong>Error Handling:</strong> Secure error responses without data leakage</li>
                </ul>
            </div>

            <h3>‚ö†Ô∏è Security Considerations</h3>
            <div class="warning-box">
                <strong>Areas Requiring Attention:</strong>
                <ul>
                    <li><strong>Permission System:</strong> Must be re-enabled for production</li>
                    <li><strong>Firestore Rules:</strong> Security rules need comprehensive testing</li>
                    <li><strong>Input Sanitization:</strong> Enhanced XSS prevention for message content</li>
                    <li><strong>API Security:</strong> Request validation and rate limiting</li>
                </ul>
            </div>
        </div>

        <div id="performance" class="tab-content" style="display: none;">
            <h2>‚ö° Performance Optimizations</h2>

            <h3>üöÄ Caching Strategy</h3>

            <h4>Multi-Level Caching:</h4>
            <ol>
                <li><strong>Memory Cache:</strong> Riverpod provider caching with dependency tracking</li>
                <li><strong>Local Storage:</strong> Offline data service for crew and message data</li>
                <li><strong>Firestore Cache:</strong> Automatic Firestore SDK caching</li>
                <li><strong>Image Cache:</strong> Network image caching for avatars and media</li>
            </ol>

            <div class="success-box">
                <strong>‚úÖ Caching Optimizations:</strong>
                <ul>
                    <li><strong>Lazy Loading:</strong> Load data only when needed</li>
                    <li><strong>Pagination:</strong> Paginated message loading (50 messages per page)</li>
                    <li><strong>Local Storage:</strong> Offline-first approach with sync</li>
                    <li><strong>Background Sync:</strong> Automatic data synchronization</li>
                </ul>
            </div>

            <h3>üìä Performance Metrics</h3>

            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Target</th>
                        <th>Implementation</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Message Load Time</td>
                        <td>&lt; 500ms</td>
                        <td>Paginated loading with cache</td>
                        <td>‚úÖ Achieved</td>
                    </tr>
                    <tr>
                        <td>Crew Switching</td>
                        <td>&lt; 300ms</td>
                        <td>Pre-loaded crew data</td>
                        <td>‚úÖ Achieved</td>
                    </tr>
                    <tr>
                        <td>Offline Operations</td>
                        <td>&lt; 100ms</td>
                        <td>Local storage queries</td>
                        <td>‚úÖ Achieved</td>
                    </tr>
                    <tr>
                        <td>Real-time Updates</td>
                        <td>&lt; 200ms</td>
                        <td>Firestore streams</td>
                        <td>‚úÖ Achieved</td>
                    </tr>
                    <tr>
                        <td>Image Loading</td>
                        <td>&lt; 1s</td>
                        <td>Network image cache</td>
                        <td>‚úÖ Achieved</td>
                    </tr>
                </tbody>
            </table>

            <h3>üîÑ Batch Operations</h3>

            <h4>Optimized Database Operations:</h4>
            <div class="code-block">
// Batch operations for efficiency
await _firestore.runTransaction((transaction) async {
  // Multiple operations in single transaction
  transaction.set(crewRef, crewData);
  transaction.set(memberRef, memberData);
  transaction.update(statsRef, statsData);
});

// Batch writes for multiple operations
final batch = _firestore.batch();
for (final member in members) {
  batch.update(memberRef, updates);
}
await batch.commit();
            </div>

            <h3>üì± Memory Management</h3>

            <h4>Optimization Strategies:</h4>
            <ul>
                <li><strong>Stream Management:</strong> Proper stream disposal to prevent memory leaks</li>
                <li><strong>Image Optimization:</strong> Compressed avatars and media</li>
                <li><strong>List Virtualization:</strong> Efficient list rendering for large datasets</li>
                <li><strong>Widget Lifecycle:</strong> Proper resource cleanup</li>
            </ul>

            <h3>üåê Network Optimization</h3>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Request Optimization</h4>
                    <ul>
                        <li>Request deduplication</li>
                        <li>Automatic retry logic</li>
                        <li>Request batching</li>
                        <li>Connection pooling</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4>Data Transfer</h4>
                    <ul>
                        <li>Delta updates only</li>
                        <li>Compressed payloads</li>
                        <li>Selective field loading</li>
                        <li>Progressive loading</li>
                    </ul>
                </div>
            </div>

            <h3>üìà Performance Monitoring</h3>

            <h4>Key Performance Indicators (KPIs):</h4>
            <div class="code-block">
// Performance tracking implementation
class PerformanceMetrics {
  static final Map&lt;String, Stopwatch&gt; _timers = {};

  static void startTimer(String operation) {
    _timers[operation] = Stopwatch()..start();
  }

  static void endTimer(String operation) {
    final timer = _timers[operation];
    if (timer != null) {
      timer.stop();
      // Log performance metrics
      print('$operation: ${timer.elapsedMilliseconds}ms');
      _timers.remove(operation);
    }
  }
}
            </div>
        </div>

        <h2>üîó Integration Points</h2>

        <h3>üåê Firebase Integration</h3>
        <div class="info-box">
            <strong>Firestore Collections:</strong>
            <ul>
                <li><strong>crews</strong> - Main crew documents</li>
                <li><strong>crews/{crewId}/members</strong> - Crew member subcollection</li>
                <li><strong>crews/{crewId}/invitations</strong> - Invitation subcollection</li>
                <li><strong>crewMessages</strong> - Global messages collection</li>
                <li><strong>crewConversations</strong> - Conversation metadata</li>
                <li><strong>counters</strong> - Rate limiting counters</li>
            </ul>
        </div>

        <h3>üîÑ App Feature Integration</h3>
        <table class="stats-table">
            <thead>
                <tr>
                    <th>Feature</th>
                    <th>Integration Method</th>
                    <th>Data Flow</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Job System</strong></td>
                    <td>JobSharingService</td>
                    <td>Crew ‚Üí Job Matching ‚Üí Job Display</td>
                    <td>‚úÖ Integrated</td>
                </tr>
                <tr>
                    <td><strong>User Authentication</strong></td>
                    <td>Firebase Auth</td>
                    <td>Auth ‚Üí User Profile ‚Üí Crew Access</td>
                    <td>‚úÖ Integrated</td>
                </tr>
                <tr>
                    <td><strong>Notifications</strong></td>
                    <td>FCM Service</td>
                    <td>Message ‚Üí Push Notification ‚Üí User Alert</td>
                    <td>üîÑ In Progress</td>
                </tr>
                <tr>
                    <td><strong>Union Directory</strong></td>
                    <td>Service Layer</td>
                    <td>Union ‚Üí Crew Suggestion ‚Üí Integration</td>
                    <td>üîÑ Planned</td>
                </tr>
            </tbody>
        </table>

        <h2>üß™ Testing Strategy</h2>

        <h3>üìã Test Coverage</h3>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>Unit Tests</h4>
                <ul>
                    <li>CrewModel tests</li>
                    <li>CrewService tests</li>
                    <li>CrewMember tests</li>
                    <li>Validation tests</li>
                    <li>Utility tests</li>
                </ul>
            </div>

            <div class="feature-card">
                <h4>Integration Tests</h4>
                <ul>
                    <li>Crew workflow tests</li>
                    <li>Messaging flow tests</li>
                    <li>Offline sync tests</li>
                    <li>Permission tests</li>
                    <li>Service integration tests</li>
                </ul>
            </div>

            <div class="feature-card">
                <h4>Widget Tests</h4>
                <ul>
                    <li>CrewChatScreen tests</li>
                    <li>CrewInvitationCard tests</li>
                    <li>CrewMessageBubble tests</li>
                    <li>CrewSelectionDropdown tests</li>
                    <li>Electrical component tests</li>
                </ul>
            </div>
        </div>

        <h2>üîÆ Future Enhancements</h2>

        <h3>üöÄ Planned Features</h3>
        <div class="timeline">
            <div class="timeline-item">
                <h4>Q1 2025: Enhanced Permissions</h4>
                <p>Re-enable and enhance the permission system with granular controls and audit logging.</p>
            </div>

            <div class="timeline-item">
                <h4>Q1 2025: Advanced Analytics</h4>
                <p>Comprehensive crew performance analytics with predictive insights and recommendations.</p>
            </div>

            <div class="timeline-item">
                <h4>Q2 2025: Video Calling</h4>
                <p>Integrated video calling for crew meetings and consultations.</p>
            </div>

            <div class="timeline-item">
                <h4>Q2 2025: GPS Integration</h4>
                <p>Real-time location tracking for field crews with geofencing capabilities.</p>
            </div>

            <div class="timeline-item">
                <h4>Q3 2025: AI-Powered Matching</h4>
                <p>Machine learning algorithms for enhanced job-crew matching accuracy.</p>
            </div>
        </div>

        <h3>üí° Technical Improvements</h3>
        <ul>
            <li><strong>GraphQL Integration:</strong> Replace REST calls with GraphQL for better data fetching</li>
            <li><strong>Advanced Caching:</strong> Implement Redis or similar for enhanced caching</li>
            <li><strong>Microservices Architecture:</strong> Split services for better scalability</li>
            <li><strong>Real-time Analytics:</strong> WebSocket-based real-time performance metrics</li>
            <li><strong>Enhanced Security:</strong> Implement end-to-end encryption for sensitive communications</li>
        </ul>

        <div class="success-box">
            <h3>‚úÖ Conclusion</h3>
            <p>The crews feature is a comprehensive, well-architected system that effectively serves the unique needs of IBEW electrical workers. With its robust permission system, real-time messaging capabilities, job sharing functionality, and industry-specific theming, it provides a complete solution for crew management in the electrical industry.</p>
            <p>The modular architecture, comprehensive testing strategy, and offline-first approach ensure reliability and performance. While some areas (like the permission system) need to be re-enabled for production, the overall foundation is solid and ready for deployment.</p>
        </div>

        <div class="info-box">
            <p><strong>üìÖ Report Generated:</strong> October 26, 2025</p>
            <p><strong>üîç Analysis Scope:</strong> Complete crews feature implementation including all models, services, UI components, and integration points</p>
            <p><strong>üë• Target Audience:</strong> IBEW electrical workers (journeymen, linemen, wiremen, operators, tree trimmers)</p>
        </div>
    </div>

    <script>
        function showTab(tabId) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.style.display = 'none');

            // Show selected tab
            document.getElementById(tabId).style.display = 'block';

            // Update active tab button
            const buttons = document.querySelectorAll('.nav-tab');
            buttons.forEach(button => button.classList.remove('active'));
            event.target.classList.add('active');
        }
    </script>
</body>
</html>