rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ============================================================================
    // DEV MODE: SIMPLIFIED SECURITY RULES FOR DEVELOPMENT TESTING
    // ============================================================================
    // TODO: Re-enable full permission system before production deployment
    //
    // IMPORTANT: These rules allow ALL authenticated users to access ALL data.
    // This is ONLY safe for development with a single developer and no sensitive data.
    //
    // Original complex rules included:
    // - Role-based access control (foreman, lead, member)
    // - Crew membership validation
    // - Permission matrices for different operations
    // - Field-level update restrictions
    // - Rate limiting and validation
    //
    // To restore production security:
    // 1. Restore helper functions (isForeman, isCrewMember, hasPermission, etc.)
    // 2. Re-implement role-based access control on crews collection
    // 3. Add validation for crew updates (isValidCrewUpdate)
    // 4. Restore author/ownership checks on posts and jobs
    // 5. Re-enable participant validation on conversations/messages
    // ============================================================================

    // Basic authentication check
    function isAuthenticated() {
      return request.auth != null;
    }

    // Users collection: Authenticated users can manage their own profiles
    match /users/{userId} {
      allow read, write: if isAuthenticated();
    }

    // User preferences collection: Authenticated users can manage their own preferences
    match /user_preferences/{userId} {
      allow read, write: if isAuthenticated();
    }

    // Preferences collection (legacy/alternative path): Authenticated users can manage their own preferences
    match /preferences/{userId} {
      allow read, write: if isAuthenticated();
    }

    // Crews collection: DEV MODE - All authenticated users have full access
    match /crews/{crewId} {
      allow read, write: if isAuthenticated();

      // Crew members subcollection
      match /members/{memberId} {
        allow read, write: if isAuthenticated();
      }

      // Feed posts subcollection
      match /feedPosts/{postId} {
        allow read, write: if isAuthenticated();
      }

      // Invitations subcollection
      match /invitations/{invitationId} {
        allow read, write: if isAuthenticated();
      }

      // Applications subcollection
      match /applications/{applicationId} {
        allow read, write: if isAuthenticated();
      }
    }

    // Jobs collection: All authenticated users have full access
    match /jobs/{jobId} {
      allow read, write: if isAuthenticated();
    }

    // Conversations collection: All authenticated users have full access
    match /conversations/{convId} {
      allow read, write: if isAuthenticated();

      // Messages subcollection
      match /messages/{msgId} {
        allow read, write: if isAuthenticated();
      }
    }

    // Locals collection: Read-only for authenticated users
    match /locals/{localId} {
      allow read: if isAuthenticated();
      allow write: if false; // Read-only
    }

    // Counters collection: All authenticated users have full access
    match /counters/{document=**} {
      allow read, write: if isAuthenticated();
    }

    // Abuse reports collection: All authenticated users can report
    match /abuse_reports/{reportId} {
      allow read, write: if isAuthenticated();
    }
  }
}